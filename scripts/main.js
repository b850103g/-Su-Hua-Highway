"use strict";function update(e){stage.update();var t=$("#"+canvas_id),n=t[0].toDataURL(),a=$("#"+export_image_id);a.attr("src",n)}function wraping_text(e){var t=e.wording,n=e.current_cut||1,a=e.c_cut_start||0,r=e.row||0,o=e.c_wording||t,i=e.paragraph||0,d=36,c=800,u=new createjs.Text(o,d+"px Arial");u.lineWidth=c;var s=u.getMeasuredWidth();if(s>=c)return o=t.substr(a,t.length-n),wraping_text({wording:t,c_wording:o,c_cut_start:a,current_cut:n+1,row:r,paragraph:i});var l=r*d*1.3;i>0&&(l+=i*d*3),u.y=l,stage.addChild(u);var f=t.indexOf(o)+o.length;return f!==t.length?wraping_text({wording:t,c_wording:!1,c_cut_start:f,current_cut:!1,row:r+1,paragraph:i}):r}function on_text_change(e){var e=e||"高速公路好可怕",t=new Date,n=t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日",a="本人%NAME%願意簽署這份文件，因為高速公路及快速公路實在太危險，現階段(%NOW%)不適合沒有路權的二輪車輛行駛。並且認為在不合法的情況下騎乘上去非常沒有素質。 \n";a+="倘若將來，高速公路開放紅黃牌摩托車行駛，與快速道路開放白牌摩托車行駛，本人%NAME%同意，絕對不在上敘道路使用摩托車（如：紅黃牌行駛高速公路，白牌行駛快速公路），若違反的話，願意上傳自爆菊花影片到社群網站上，表示個人素質與爆菊花決心。";var r={"%NAME%":e,"%NOW%":n,"%EVENT%":"20"};a=a.replace(/%\w+%/g,function(e){return r[e]||e}),a=a.trim().split("\n"),stage.removeAllChildren();(new Date).getTime();console.time("wraping_text");for(var o=0,i=0;i<a.length;i++)o=wraping_text({wording:a[i],row:o,paragraph:i});console.timeEnd("wraping_text"),update()}var saveAs=saveAs||function(e){if(!("undefined"==typeof e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},a=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in a,o=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/constructor/i.test(e.HTMLElement),d=/CriOS\/[\d]+/.test(navigator.userAgent),c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",s=4e4,l=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,s)},f=function(e,t,n){t=[].concat(t);for(var a=t.length;a--;){var r=e["on"+t[a]];if("function"==typeof r)try{r.call(e,n||e)}catch(o){c(o)}}},g=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},p=function m(t,c,s){s||(t=g(t));var p,m=this,v=t.type,w=v===u,h=function(){f(m,"writestart progress write writeend".split(" "))},_=function(){if((d||w&&i)&&e.FileReader){var a=new FileReader;return a.onloadend=function(){var t=d?a.result:a.result.replace(/^data:[^;]*;/,"data:attachment/file;"),n=e.open(t,"_blank");n||(e.location.href=t),t=void 0,m.readyState=m.DONE,h()},a.readAsDataURL(t),void(m.readyState=m.INIT)}if(p||(p=n().createObjectURL(t)),w)e.location.href=p;else{var r=e.open(p,"_blank");r||(e.location.href=p)}m.readyState=m.DONE,h(),l(p)};return m.readyState=m.INIT,r?(p=n().createObjectURL(t),void setTimeout(function(){a.href=p,a.download=c,o(a),h(),l(p),m.readyState=m.DONE})):void _()},v=p.prototype,w=function(e,t,n){return new p(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=g(e)),navigator.msSaveOrOpenBlob(e,t)}:(v.abort=function(){},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,w)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||(void 0).content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs});var canvas_id="text-canvas",export_image_id="export-image",stage;jQuery(document).ready(function(e){e("#name").focus(),e(".download").on("click",function(t){t.preventDefault();var n=e("#name").val(),a=document.getElementById(canvas_id),r=(a.getContext("2d"),n+"-爆菊花同意書.png");a.toBlob(function(e){saveAs(e,r)}),ga("send","event","點擊",r,"下載")}),e("#submit").on("click",function(t){var n=e("#name").val();0===n.length?alert("您沒有輸入名字唷!"):(e(".jumbotron").hide(),e(".marketing").show()),ga("send","event","點擊",n,"送出"),e(".download").trigger("click")}),e("#name").on("keyup",function(t){var n=e(this).val();on_text_change(n)}),stage=new createjs.Stage(canvas_id)}),$(window).on("resize",function(){update()});